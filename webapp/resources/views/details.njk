{% extends 'base' %}

{% block title %}
	{{ dataset.summary }}
{% endblock %}

{% block content %}
	<h1>{{ dataset.summary }}</h1>

	<ul class="list-group">
		<li class="list-group-item">
			<h4 class="list-group-item-heading">{{ dataset.description }}</h4>
			<p class="list-group-item-text">Description</p>
		</li>
		<li class="list-group-item">
			<h4 class="list-group-item-heading">{{ dataset.access }}</h4>
			<p class="list-group-item-text">Access</p>
		</li>
		<li class="list-group-item">
			<h4 class="list-group-item-heading">{{ dataset.format }}</h4>
			<p class="list-group-item-text">Format</p>
		</li>
		<li class="list-group-item">
			<h4 class="list-group-item-heading">{{ dataset.link }}</h4>
			<p class="list-group-item-text">Link</p>
		</li>
		<li class="list-group-item">
			<h4 class="list-group-item-heading">{{ dataset.rate }}</h4>
			<p class="list-group-item-text">Rate</p>
		</li>
		<li class="list-group-item">
			<h4 class="list-group-item-heading">{{ dataset.updated_at }}</h4>
			<p class="list-group-item-text">Updated at</p>
		</li>
	</ul>

	<div class="row">
		<div class="col-xs-12">
			<div class="text-right">
				{% if currentUser.isAdmin or currentUser.id == dataset.user_id %}
					<a href="{{ 'modify' | route({id: dataset.id})}}" class="btn btn-primary">Modify</a>
					<a href="{{ 'delete' | route({id: dataset.id})}}" class="btn btn-danger">Delete</a>
				{% endif %}
			</div>
		</div>
	</div>

	<h3>Reviews</h3>

	{% for review in reviews %}
		<div class="panel panel-default">
			<div class="panel-body">
				<span class="badge">{{ review.rate }}</span>
				{{ review.comment }}
			</div>
			<div class="panel-footer">
			{{ review.updated_at }}
				<div class="pull-right">
					{% if currentUser.isAdmin or currentUser.id == review.user_id %}
						<a href="{{ 'deleteReview' | route({id: dataset.id, review_id: review.id})}}" class="btn btn-danger ">Delete</a>
					{% endif %}
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
	{% endfor %}

	{% if currentUser %}
		<a href="#" class="btn btn-primary pull-right">Review</a>
	{% endif %}

	{% if currentUser %}
		<p>
			{{ form.open({ route: 'review', params: {id: dataset.id} }) }}

			{{ csrfField }}

			<fieldset>
				{{ form.label('Rate') }}
				{{ form.selectRange('rate', 1, 6) }}
			</fieldset>

			<fieldset>
				{{ form.label('Comment') }}
				{{ form.text('comment') }}
			</fieldset>

			{{ form.submit('Add Review') }}

			{{ form.close() }}
		</p>
	{% endif %}
{% endblock %}
